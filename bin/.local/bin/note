#! /bin/sh

if [[ ! -d "$HOME/Documents/Journal" ]] ; then
    echo "Journal not found"
    exit 1
fi

cd "$HOME/Documents/Journal"

year=`date "+%Y"`
month=`date "+%m"`
day=`date "+%d"`

if [[ -d "$year" ]] ; then
    if [[ ! -d "$year/$month" ]] ; then
        mkdir "$year/$month"
    fi
else
    mkdir "$year" "$year/$month"
fi

if [[ "$TERM_PROGRAM" = tmux ]] ; then
    if ! tmux has-session -t MASTER 2> /dev/null ; then
        echo "MASTER session does not exist"
        exit 1
    fi

    tmux list-windows -t MASTER | grep note 1> /dev/null ||
    ( tmux neww -d -n note -t MASTER &&
    tmux send-keys -t MASTER:note "vi \"$year/$month/$day.txt\"" Enter )

    tmux switch-client -t MASTER:note

else
    vi "$year/$month/$day.txt"
fi

