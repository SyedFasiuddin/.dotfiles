#!/bin/sh

# DIR=$(pwd | sed -E 's/^.*\///' 2> /dev/null)
DIR=$(basename $(pwd) | sed -E 's/\./_/g')
# tmux replaced dot in session names with underscores (default)

if [[ -z $DIR ]]; then
    exit 1
fi

tmux has-session -t "$DIR" 2> /dev/null || (
    tmux new -d -s $DIR

    # 1st & 3rd window
    if [[ -f "Cargo.toml" ]] ; then
        # Rust
        tmux rename-window -t $DIR:1 bacon
        tmux send-keys -t $DIR:1 'bacon' Enter

        tmux neww -d -n cargo -t $DIR:3
    else
        # Other (Assuming JavaScript)
        tmux rename-window -t $DIR:1 server
        tmux split-window -h -t $DIR:server

        tmux neww -d -n misc -t $DIR:3
    fi

    # 2nd window
    tmux neww -d -n vi -t $DIR:2
    tmux send-keys -t $DIR:2 'nvim' Enter

    # 4th window
    if [[ -d ".git" ]] ; then
        tmux neww -d -n git -t $DIR:4
    fi
)

if [[ -z $TMUX ]]; then
    tmux a -t $DIR
else
    tmux switch-client -t $DIR
fi
